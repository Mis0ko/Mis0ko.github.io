---
title:  "Lecture de Fichiers"
category: "Exploitation"
tag: "Principes de base de l'injection SQL"
---
Au dela de la récupération de données concernant les tables et BDD dans le SGBD, une injection SQL peut aussi être utilisé pour effectuer de nombreuses autres opérations, telles que la lecture et l'écriture de fichiers sur un serveur et même l'exécution de code à distance (RCE) sur le serveur distant.

> Lire des données est bien plus commun que d'en écrire, qui est réservé aux utilisateurs ayant les privilèges adéquat dans les SGBD modernes. Sur **MySQL** par exemple, l'utilisateur doit avoir le privilège **FILE** avant de pouvoir charger un fichier dans une table.

# Identification de l'utilisateur DB

Il est nécessaire de d'abord identifier quel utilisateur nous sommes dans la base de données ainsi que nos privilèges. Dans les SGBD modernes, il faut être **DBA** (database Admin) pour avoir le privilège de lecture/écriture de fichier.

Pour déterminer cela, nous pouvons utiliser les commandes suivantes :

```sql
SELECT USER()
SELECT CURRENT_USER()
SELECT user from mysql.user
```

Avec une injection de tye **UNION**
```sql
cn' UNION SELECT 1, user(), 3, 4-- -
ou
cn' UNION SELECT 1, user, 3, 4 from mysql.user-- -
```
Dans notre cas, nous sommes root.

<center><img src="/assets/images/htbAcademy/SQLInjectionFundamentals/readingFiles1.png" alt="Alt text"></center>

# Privilège de l'utilisateur

Vérification du privilège super-admin (avec éventuellement WHERE user="ourUser" ):

```sql
SELECT super_priv FROM mysql.user
```

Affichage des autres privilèges :

```sql
SELECT grantee, privilege_type FROM information_schema.user_privileges 
```
<center><img src="/assets/images/htbAcademy/SQLInjectionFundamentals/readingFiles2.png" alt="Alt text"></center>

Si on a le droit **FILE** comme dans l'exemple ici, nous pouvons lire les fichiers (et peut être même écrire).


# LOAD_FILE()

Une fois que l'on sait que nousavons les privilèges pour lire les fichiers du système local, nous pouvons utiliser la fonction **LOAD_FILE()**. **[LOAD_FILE](https://mariadb.com/kb/en/load_file/)** peut être utilisé avec **MariaDB / MySQL** pour lire les données provenant d'un fichier.

```sql
SELECT LOAD_FILE('/etc/passwd');
SELECT LOAD_FILE('/var/www/html/search.php');
```

> Remarque : nous ne pourrons lire le fichier que si l'utilisateur du système d'exploitation qui exécute MySQL dispose des privilèges suffisants pour le lire.

On peut utiliser les injections sql pour récupérer des informations sensibles contenues dans des fichiers comme le code source d'une application.


